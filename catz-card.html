<link rel="import" href="bower_components/polymer/polymer.html">

<link rel="import" href="bower_components/paper-card/paper-card.html">

<dom-module id="catz-card">
  <template>

    <style>
      app-header {
        color: #fff;
        background-color: deepskyblue;
      }

      app-toolbar {
        height: 120px;
      }

      [condensed-title] {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background-image: url('images/logo@0.75x.png');
        background-repeat: no-repeat;
        background-position: center center;
        background-size: 90px;
        /* The difference in font size is used to calculate the scale of the title in the transition. */
        font-size: 16px;
      }

      [main-title] {
        position: absolute;
        top: -120px;
        bottom: 0;
        left: 0;
        right: 0;
        background-image: url('images/logo.png');
        background-repeat: no-repeat;
        background-position: center center;
        background-size: 240px;
        -webkit-transform-origin: center top !important;
        transform-origin: center top !important;
        /* The difference in font size is used to calculate the scale of the title in the transition. */
        font-size: 32px;
      }

      .content {
        display: block;
        position: relative;
        max-width: 1000px;
        margin: 5px auto;
      }

      .card-container {
        display: inline-block;
        width: 33.33%;
        color: black;
        text-decoration: none;
      }

      #makeLike {
        color: lightblue;
      }

      #makeUnlike {
        color: deepskyblue;
      }

      paper-card {
        display: block;
        margin: 5px;
        --paper-card-header-image: {
          height: auto;
        }
      }

      paper-card h2 {
        margin: 4px;
        font-weight: normal;
      }

      paper-card p {
        margin: 4px;
        color: #999;
      }
    </style>

    <!-- main panel -->

    <paper-card image="{{post.imgSrc}}"
                id$="[[post.$key]]">
      <div class="card-content">
        [[likeCount]]
        <paper-icon-button id="makeLike" icon="favorite" hidden$="[[isLiked]]" on-tap="makeLike"></paper-icon-button>
        <paper-icon-button id="makeUnlike"  icon="favorite" hidden$="[[!isLiked]]"  on-tap="makeUnlike"></paper-icon-button>
        <!--[[isLiked]]-->
        <h2>{{post.title}}</h2>
        <p>By
          <span>{{post.author.name}}</span></p>
      </div>
    </paper-card>

  </template>

  <script>
      Polymer({
          is: 'catz-card',
          properties: {
              user : Object,
              post : {
                  type: Object,
                  notify:true

              },
              likeCount : {
                  type: Number,
                  computed : 'cmpLike(post)'

              },
              isLiked : {
                  type: Boolean,
                  computed : 'cmpIsLike(post)'

              }
          },
          cmpLike: function (post) {
              console.log("cmpLike ",post);
              if(post.likers){
                  return post.likers.length;
              }
              return 0;
          },
          cmpIsLike: function (post) {
              console.log("cmpIsLike ",post);
              if(post.likers){
                  return (post.likers.indexOf(this.user.uid) > -1)
              }
              return false;
          },
          makeLike: function () {
              var post = this.post;
              if(!post.likers){
                  post.likers = [];
              }
              post.likers.push(this.user.uid);

              this.post = JSON.parse(JSON.stringify(post));
          },
          makeUnlike: function () {
              var post = this.post;

              post.likers.pop(this.user.uid);
              this.post = JSON.parse(JSON.stringify(post));
          }
      });
  </script>
</dom-module>